- name: "Create {{ nfsd_services_path }}"
  ansible.builtin.copy:
    dest: "{{ nfsd_services_path }}"
    mode: "0664"
    backup: true
    content: |
      ---
      # Generated by .configure.yml

      fp_nfsd_services_enable:
      {% for service, var in nfsd_services.items() %}
        - label: "nfsd: Start {{ service }}"
          conf: "{{ _beg }} fp_{{ var }}_enable_rcconf {{ _end }}"
          when: "{{ _beg }} fp_{{ var }}_enable | bool {{ _end }}"
          notify: "{{ _beg }} fp_nfsd_handlers.{{ service }} {{ _end }}"
      {% endfor %}

      fp_nfsd_services_disable:
      {% for service, var in nfsd_services.items() %}
        - label: "nfsd: Stop {{ service }}"
          conf: "{{ _beg }} fp_{{ var }}_disable_rcconf {{ _end }}"
          when: "{{ _beg }} not fp_{{ var }}_enable | bool {{ _end }}"
          notify: stop {{ service }}
      {% endfor %}
